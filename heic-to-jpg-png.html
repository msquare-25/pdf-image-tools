<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEIC to JPG/PNG Converter</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        .container { max-width: 500px; margin: auto; border: 2px dashed #ccc; padding: 30px; border-radius: 10px; }
        select, button { padding: 10px; margin: 10px; font-size: 16px; }
        button { background-color: #28a745; color: white; border: none; cursor: pointer; }
        button:disabled { background-color: #ccc; }
        #status { margin-top: 20px; font-weight: bold; }
        #downloadBtn { display: none; margin-top: 20px; text-decoration: none; background: #007bff; color: white; padding: 10px 20px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>HEIC to Image Converter</h2>
        
        <input type="file" id="fileInput" accept=".heic" />
        <br><br>

        <label>Format: </label>
        <select id="formatSelect">
            <option value="image/jpeg">JPG</option>
            <option value="image/png">PNG</option>
        </select>
        <br>

        <button id="convertBtn" onclick="convertToImage()">Convert Now</button>

        <p id="status"></p>
        <a id="downloadBtn" download="converted-image">Download Image</a>
    </div>

    <script src="library.js"></script>

    <script>
        function convertToImage() {
            const fileInput = document.getElementById('fileInput');
            const format = document.getElementById('formatSelect').value;
            const status = document.getElementById('status');
            const downloadBtn = document.getElementById('downloadBtn');
            const convertBtn = document.getElementById('convertBtn');

            // Jo file select na kari hoy to
            if (fileInput.files.length === 0) {
                alert("Please select a HEIC file first!");
                return;
            }

            const file = fileInput.files[0];

            // Processing chalu chhe evo message
            status.innerText = "Converting... Please wait.";
            convertBtn.disabled = true;
            downloadBtn.style.display = 'none';

            // HEIC Library no upyog
            heic2any({
                blob: file,
                toType: format,
                quality: 0.8 // 0 thi 1 ni vache quality (0.8 etle 80%)
            })
            .then(function (conversionResult) {
                // Success thay tyare
                status.innerText = "Conversion Successful!";
                
                // Download link banavvi
                const url = URL.createObjectURL(conversionResult);
                
                // Extension nakki karvu (jpg ke png)
                const extension = format === "image/jpeg" ? "jpg" : "png";
                
                downloadBtn.href = url;
                downloadBtn.download = `converted-image.${extension}`;
                downloadBtn.style.display = 'inline-block';
                convertBtn.disabled = false;
            })
            .catch(function (e) {
                // Error aave tyare
                console.error(e);
                status.innerText = "Error: Could not convert file.";
                convertBtn.disabled = false;
            });
        }
    </script>

</body>
</html>
