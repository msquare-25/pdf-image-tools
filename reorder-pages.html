<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Free, fast, and private PDF & Image tools — everything runs in your browser (no uploads).">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reorder PDF Pages — PDF & Image Tools</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="stylesheet" href="/style.css" />
  <script defer src="/site.js"></script>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* 5 thumbnails per row (responsive like Delete/Merge) */
    .thumb-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px;margin-top:12px}
    @media (max-width:1280px){.thumb-grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    @media (max-width:980px){.thumb-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media (max-width:720px){.thumb-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:480px){.thumb-grid{grid-template-columns:repeat(1,minmax(0,1fr))}}

    .thumb{border:1px solid var(--border);border-radius:12px;background:var(--surface);position:relative;text-align:center;padding:8px 8px 34px;box-shadow:var(--shadow-sm);cursor:grab;user-select:none}
    .thumb.dragging{opacity:.65;outline:2px dashed #a8b4ff}
    .thumb.drag-over{border-color:var(--brand-1);box-shadow:0 0 0 3px rgba(124,58,237,.18)}
    .thumb canvas{width:100%;height:auto;display:block;background:var(--surface-2);border-radius:8px}
    .thumb .meta{position:absolute;left:8px;right:8px;bottom:6px;display:flex;align-items:center;justify-content:space-between;font-size:12px;color:var(--muted)}
    .thumb .badge{background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-weight:800}
    .dropping{outline:2px dashed var(--brand-1);outline-offset:6px}
  </style>
</head>
<body class="reorder-page">

<header class="site-header">
  <div class="container bar">
    <div class="brand">
      <span class="logo"></span>
      <span>PDF &amp; Image Tools</span>
    </div>

    <div class="container tool-tabs-wrap">
      <button class="tool-scroll tool-left" aria-label="Scroll left">‹</button>
      <nav class="tool-tabs" role="navigation" aria-label="Tools">
        <a href="/merge" data-tip="Combine multiple PDFs into one">Merge PDF</a>
        <a href="/delete-pages" data-tip="Remove pages you don’t need">Delete pages</a>
        <a href="/rotate-pages" data-tip="Rotate pages left/right">Rotate PDF</a>
        <a href="/reorder-pages" class="active" data-tip="Drag &amp; reorder pages">Reorder PDF</a>
        <a href="/crop" data-tip="Cut margins or select an area">Crop PDF</a>
        <a href="/compress" data-tip="Reduce PDF file size">Compress PDF</a>
        <a href="/pdf-to-images" data-tip="Export pages as PNG/JPG">PDF → Images</a>
        <a href="/image-to-pdf" data-tip="Make a PDF from images">Image → PDF</a>
        <a href="/jpg-to-png" data-tip="Convert JPG to PNG">JPG → PNG</a>
        <a href="/png-to-jpg" data-tip="Convert PNG to JPG">PNG → JPG</a>
      </nav>
      <button class="tool-scroll tool-right" aria-label="Scroll right">›</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">

    <!-- ===== 3 boxes ===== -->
    <aside class="panel">
      <div class="grid-3">

        <!-- LEFT: Upload -->
        <section class="panel card box upload-box theme-center" id="dropzone" aria-label="Upload">
          <h2 class="title">Upload</h2>
          <p class="muted">Drag &amp; drop your PDF or browse</p>

          <label for="file" class="btn gradient big">Browse PDF</label>
          <input id="file" type="file" accept="application/pdf" hidden />
          <div class="pill mt-2" id="meta">No file</div>
          <button class="btn subtle mt-1" id="clearBtn" disabled>Clear</button>

          <div class="small mt-2">Everything runs in your browser (no uploads).</div>
        </section>

        <!-- CENTER: Setting + Pages (but title only "Setting") -->
        <section class="panel card box setting-box theme-center" aria-label="Setting">
          <h2 class="title">Setting</h2>

          <div class="row" style="gap:10px;align-items:center;justify-content:center">
            <button class="btn" id="btnReset" disabled>Reset order</button>
          </div>

          <div id="pages" class="thumb-grid"></div>
          <div id="err" class="error" style="display:none"></div>
        </section>

        <!-- RIGHT: Download -->
        <section class="panel card box action-box theme-center" aria-label="Download">
          <h2 class="title">Download</h2>
          <progress id="prog" max="100" value="0" class="w-100"></progress>
          <div id="status" class="small">Idle…</div>
          <div class="row center mt-2" style="gap:10px">
            <button id="btnExport" class="btn primary-blue" disabled>Download New PDF</button>
            <button id="btnCancel" class="btn ghost" style="display:none">Cancel</button>
          </div>
        </section>

      </div>
    </aside>

    <!-- ===== Title + How it works (BELOW 3 boxes) ===== -->
    <main class="panel after-grid">
      <h1 class="page-title">Reorder PDF Pages</h1>
      <p class="sub">Drag thumbnails to rearrange pages and export — everything runs in your browser.</p>

      <section class="card mt-3">
        <h2 class="title">How it works</h2>
        <ul class="sub">
          <li>Upload your PDF and preview thumbnails in the center box.</li>
          <li>Drag &amp; drop thumbnails to rearrange. Use <b>Reset order</b> to go back.</li>
          <li>Export a new PDF with pages in the new order.</li>
        </ul>
        <p class="sub mt-1">Privacy: No uploads. Everything stays on your device.</p>
      </section>
    </main>

  </div>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";</script>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

  <!-- page script -->
  <script>
    const $ = s => document.querySelector(s);

    // Elements
    const drop = $('#dropzone');
    const fileEl = $('#file'), metaEl = $('#meta'), clearBtn = $('#clearBtn');
    const btnReset = $('#btnReset');
    const btnExport = $('#btnExport'), btnCancel = $('#btnCancel');
    const prog = $('#prog'), statusEl = $('#status');
    const pagesEl = $('#pages'), errEl = $('#err');

    // State
    let fileBuf = null;          // original ArrayBuffer
    let pageCount = 0;
    let origName = 'document.pdf';
    let originalOrder = [];       // [0..n-1]

    function setStatus(t){ statusEl.textContent = t; }
    function setProgress(done,total){ prog.value = total ? Math.round(done/total*100) : 0; }
    function showError(t){ errEl.style.display='block'; errEl.textContent = String(t); }
    function clearError(){ errEl.style.display='none'; errEl.textContent=''; }
    function updateMeta(){ metaEl.textContent = fileBuf ? `${pageCount} pages` : 'No file'; }

    function outputName(base, suffix){
      const m = base.match(/^(.*?)(\.[^.]+)?$/); const stem = m?.[1] || 'document'; const ext = (m?.[2] || '.pdf');
      return `${stem}${suffix}${ext}`;
    }
    function downloadBlob(blob, name){
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href),1500);
    }

    // ==== Drag & Drop Reorder =====
    function cardTemplate(i, canvas){
      const wrap = document.createElement('div'); wrap.className='thumb'; wrap.draggable = true; wrap.dataset.page = i; // zero-based index from source
      const meta = document.createElement('div'); meta.className='meta';
      const left = document.createElement('div'); left.innerHTML = `<span class="badge">#${i+1}</span>`;
      const right = document.createElement('div'); right.className='small'; right.textContent = 'Drag';
      meta.append(left, right);
      wrap.append(canvas, meta);

      // dnd handlers
      wrap.addEventListener('dragstart', e=>{ wrap.classList.add('dragging'); e.dataTransfer.effectAllowed='move'; });
      wrap.addEventListener('dragend', ()=> wrap.classList.remove('dragging'));
      wrap.addEventListener('dragover', e=>{ e.preventDefault(); wrap.classList.add('drag-over'); });
      wrap.addEventListener('dragleave', ()=> wrap.classList.remove('drag-over'));
      wrap.addEventListener('drop', e=>{
        e.preventDefault(); wrap.classList.remove('drag-over');
        const dragging = pagesEl.querySelector('.dragging');
        if(dragging && dragging !== wrap){
          const kids=[...pagesEl.children];
          const from=kids.indexOf(dragging), to=kids.indexOf(wrap);
          if(from < to) wrap.after(dragging); else wrap.before(dragging);
          updateResetState();
          renumberBadges();
        }
      });
      return wrap;
    }

    function renumberBadges(){
      [...pagesEl.children].forEach((el, idx)=>{
        const badge = el.querySelector('.badge');
        if(badge) badge.textContent = `#${idx+1}`;
      });
    }

    function updateResetState(){
      const current = [...pagesEl.children].map(c=>parseInt(c.dataset.page,10));
      const same = current.length===originalOrder.length && current.every((v,i)=>v===originalOrder[i]);
      btnReset.disabled = same;
    }

    async function renderPages(){
      pagesEl.innerHTML = ''; clearError();
      const pdf = await pdfjsLib.getDocument({ data: new Uint8Array(fileBuf.slice(0)) }).promise;
      pageCount = pdf.numPages; originalOrder = Array.from({length:pageCount}, (_,i)=>i); updateMeta();

      for(let i=1;i<=pageCount;i++){
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({ scale: 0.25 });
        const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
        canvas.width = viewport.width; canvas.height = viewport.height;
        await page.render({ canvasContext: ctx, viewport }).promise;
        pagesEl.appendChild(cardTemplate(i-1, canvas));
        page.cleanup && page.cleanup();
      }
      pdf.cleanup && pdf.cleanup();

      btnExport.disabled = false; btnReset.disabled = true; setStatus('Ready');
    }

    async function handleFile(file){
      if(!file) return; origName = file.name || 'document.pdf';
      setStatus('Loading…'); fileBuf = await file.arrayBuffer();
      await renderPages(); clearBtn.disabled = false;
    }

    // Upload inputs
    fileEl.addEventListener('change', e => handleFile(e.target.files?.[0]));

    // Drag & Drop (left box)
    ['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); drop.classList.add('dropping'); }));
    ['dragleave','drop'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); drop.classList.remove('dropping'); }));
    drop.addEventListener('drop', e => handleFile(e.dataTransfer?.files?.[0]));

    // Clear
    clearBtn.addEventListener('click', () => {
      fileBuf = null; pageCount = 0; originalOrder = [];
      pagesEl.innerHTML = ''; metaEl.textContent = 'No file'; setStatus('Idle…'); setProgress(0,0);
      clearBtn.disabled = true; btnExport.disabled = true; btnReset.disabled = true; fileEl.value = '';
    });

    // Reset to original order
    btnReset.addEventListener('click', async ()=>{ await renderPages(); });

    // Build & Download
    btnExport.addEventListener('click', async ()=>{
      if(!fileBuf){ alert('Choose a PDF first.'); return; }
      setStatus('Building…'); btnExport.disabled = true; clearError();
      try{
        const src = await PDFLib.PDFDocument.load(new Uint8Array(fileBuf), { ignoreEncryption:true });
        const out = await PDFLib.PDFDocument.create();
        const order = [...pagesEl.children].map(c=>parseInt(c.dataset.page,10));
        const copied = await out.copyPages(src, order);
        copied.forEach(p=>out.addPage(p));
        const bytes = await out.save({ useObjectStreams:false });
        downloadBlob(new Blob([bytes],{type:'application/pdf'}), outputName(origName,'-reordered'));
        setStatus('Done.');
      }catch(e){ showError(e?.message||e); setStatus('Error.'); }
      finally{ btnExport.disabled = false; setProgress(0,0); }
    });
  </script>
</main>
</body>
</html>
